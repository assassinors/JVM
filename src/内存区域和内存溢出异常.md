### 内存区域和内存溢出异常

#### 运行时数据区域

- 程序计数器：线程独有，记录虚拟机字节码地址，没有OutOfMemory异常
- 虚拟机栈：线程私有，方法对应栈帧，可以动态扩展，有StackOverFlow异常和OutOfMemory异常
  - 局部变量表
  - 操作数栈
  - 动态连接
  - 方法返回地址
- 本地方法栈：native方法
- hotSpot不区分虚拟机栈和本地方法栈
- 堆：存放对象实例，GC堆，OutOfMemory异常
  - 分代：新生代和老生代
- 方法区：存放已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据，OutOfMemory异常
- 运行时常量池：方法区的一部分
- 直接内存

#### HotSpot虚拟机对象

1. 类加载检查
2. 分配内存：指针碰撞（Bump the Pointer)，空闲列表（Free List)，具体的取决于垃圾收集器
3. 内存空间置0，对对象进行设置（对象头）
4. 执行<init>方法

##### 对象的内存布局

- 对象头
  - 自身对象运行时数据：hash码、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳等
  - 类型指针，虚拟机通过这个指针来确定对象是哪个类的实例
- 实例数据
  - 有效信息
- 对齐填充：不必然存在

##### 对象的访问定位

- 句柄
  - 堆中划分句柄池，reference存储对象的句柄地址，句柄包含对象实例数据与类型数据各自具体的地址信息
  - 优点：对象移动时，不用修改reference
- 直接指针
  - 存放直接的对象地址
  - 优点：速度快
  - HotSpot使用该方式

